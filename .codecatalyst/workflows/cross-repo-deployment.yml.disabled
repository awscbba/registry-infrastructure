Name: Cross-Repository-Deployment
SchemaVersion: "1.0"

# Only trigger on push to main (after merge) and PR validation
Triggers:
  - Type: PUSH
    Branches:
      - main
  - Type: PULLREQUEST
    Branches:
      - main
    Events:
      - OPEN
      - REVISION

Actions:
  # Validate infrastructure code (runs on PRs and main pushes)
  ValidateInfrastructure:
    Identifier: aws/build@v1
    Environment:
      Name: production
      Connections:
        - Name: 142728997126
          Role: CodeCatalystWorkflowDevelopmentRole-AWSCocha
    Inputs:
      Sources:
        - WorkflowSource
    Configuration:
      Commands:
        - 'echo "Setting up environment..."'
        - 'export PROJECT_NAME="people-registry"'
        - 'export STACK_NAME="PeopleRegisterInfrastructureStack"'
        - 'export AWS_REGION="us-east-1"'
        - 'export ENVIRONMENT="production"'
        - 'export APPLICATION_NAME="People Register"'
        - 'export APPLICATION_VERSION="1.0.0"'
        - 'echo "üîç Validating infrastructure for $APPLICATION_NAME ($PROJECT_NAME)"'
        - 'echo "Stack: $STACK_NAME | Region: $AWS_REGION | Environment: $ENVIRONMENT"'
        - 'echo "Version: $APPLICATION_VERSION"'
        - 'echo "Running CDK synth to validate..."'
        - 'cdk synth'
        - 'echo "‚úÖ Infrastructure validation completed"'
