Name: Debug_Deployment
SchemaVersion: "1.0"

Triggers:
  - Type: PUSH
    Branches:
      - main

Actions:
  DebugEnvironment:
    Identifier: aws/build@v1
    Inputs:
      Sources:
        - WorkflowSource
    Configuration:
      Steps:
        - Run: |
            echo "ðŸ” Debug Environment Information"
            echo "================================"
            
            echo "Current user and environment:"
            whoami
            pwd
            echo "PATH: $PATH"
            
            echo "Available commands:"
            which python3 || echo "python3 not found"
            which node || echo "node not found"
            which npm || echo "npm not found"
            which curl || echo "curl not found"
            which git || echo "git not found"
            
            echo "Python version:"
            python3 --version || echo "Python3 not available"
            
            echo "Node version:"
            node --version || echo "Node not available"
            
            echo "Environment variables:"
            env | grep -E "(AWS|CODECATALYST|WORKFLOW)" | head -20
            
            echo "AWS CLI check:"
            which aws || echo "AWS CLI not found"
            aws --version || echo "AWS CLI not working"
            
            echo "AWS credentials check:"
            aws sts get-caller-identity || echo "AWS credentials not configured"
            
            echo "Workspace contents:"
            ls -la
            
            echo "Git status:"
            git status || echo "Git not available"
            
            echo "Branch information:"
            echo "Branch: ${WorkflowSource.BranchName}"
            echo "Commit: ${WorkflowSource.CommitId}"
            echo "Author: ${WorkflowSource.CommitAuthor}"
            
            echo "ðŸ” Testing basic operations..."
            
            echo "Testing curl:"
            curl -s https://httpbin.org/get | head -5 || echo "Curl test failed"
            
            echo "Testing file creation:"
            echo "test" > test-file.txt
            cat test-file.txt || echo "File operations failed"
            
            echo "Testing Python virtual environment:"
            python3 -m venv test-venv || echo "Virtual environment creation failed"
            source test-venv/bin/activate || echo "Virtual environment activation failed"
            pip --version || echo "Pip not available"
            
            echo "âœ… Debug information collection completed"
